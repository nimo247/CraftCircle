{"version":3,"file":"node-build.mjs","sources":["../../server/routes/demo.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import { RequestHandler } from \"express\";\nimport { DemoResponse } from \"@shared/api\";\n\nexport const handleDemo: RequestHandler = (req, res) => {\n  const response: DemoResponse = {\n    message: \"Hello from Express server\",\n  };\n  res.status(200).json(response);\n};\n","import \"dotenv/config\";\nimport express from \"express\";\nimport cors from \"cors\";\nimport { handleDemo } from \"./routes/demo\";\n\nexport function createServer() {\n  const app = express();\n\n  // Middleware\n  app.use(cors());\n  // Increase JSON and URL-encoded body size limits to support large bulk payloads and form submissions\n  const bodyLimit = process.env.BODY_LIMIT || \"10mb\";\n  app.use(express.json({ limit: bodyLimit }));\n  app.use(express.urlencoded({ extended: true, limit: bodyLimit }));\n\n  // Example API routes\n  app.get(\"/api/ping\", (_req, res) => {\n    const ping = process.env.PING_MESSAGE ?? \"ping\";\n    res.json({ message: ping });\n  });\n\n  app.get(\"/api/demo\", handleDemo);\n\n  // Auth routes (Firebase token verification)\n  import(\"./routes/auth\")\n    .then((authRoutes) => {\n      app.use(\"/api/auth\", authRoutes.default);\n    })\n    .catch((err) => {\n      console.warn(\"Auth routes not loaded:\", err);\n    });\n\n  // Vendor routes (Supabase server-side uploads)\n  import(\"./routes/vendor\")\n    .then((vendorRoutes) => {\n      app.use(\"/api/vendor\", vendorRoutes.default);\n    })\n    .catch((err) => {\n      console.warn(\"Vendor routes not loaded:\", err);\n    });\n\n  // Admin routes (server-side read access using service role)\n  import(\"./routes/admin\")\n    .then((adminRoutes) => {\n      app.use(\"/api/admin\", adminRoutes.default);\n    })\n    .catch((err) => {\n      console.warn(\"Admin routes not loaded:\", err);\n    });\n\n  // Vendor products routes (product CRUD for vendors)\n  import(\"./routes/vendorProducts\")\n    .then((vendorProductRoutes) => {\n      app.use(\"/api/vendor\", vendorProductRoutes.default);\n    })\n    .catch((err) => {\n      console.warn(\"Vendor products routes not loaded:\", err);\n    });\n\n  // Public products routes\n  import(\"./routes/products\")\n    .then((productsRoutes) => {\n      app.use(\"/api\", productsRoutes.default);\n    })\n    .catch((err) => {\n      console.warn(\"Public products routes not loaded:\", err);\n    });\n\n  // Public reviews routes (stores reviews server-side so everyone can view them)\n  import(\"./routes/reviews\")\n    .then((reviewsRoutes) => {\n      app.use(\"/api/reviews\", reviewsRoutes.default);\n    })\n    .catch((err) => {\n      console.warn(\"Reviews routes not loaded:\", err);\n    });\n\n  // Shipping routes (abstracted provider)\n  import(\"./routes/shipping\")\n    .then((shippingRoutes) => {\n      app.use(\"/api/shipping\", shippingRoutes.default);\n    })\n    .catch((err) => {\n      console.warn(\"Shipping routes not loaded:\", err);\n    });\n\n  // Server-side wishlist routes (use SUPABASE_SERVICE_ROLE)\n  import(\"./routes/wishlist\")\n    .then((wishlistRoutes) => {\n      app.use(\"/api/wishlist\", wishlistRoutes.default);\n    })\n    .catch((err) => {\n      console.warn(\"Wishlist routes not loaded:\", err);\n    });\n\n  // Server-side orders routes (use SUPABASE_SERVICE_ROLE)\n  import(\"./routes/orders\")\n    .then((ordersRoutes) => {\n      app.use(\"/api/orders\", ordersRoutes.default);\n    })\n    .catch((err) => {\n      console.warn(\"Orders routes not loaded:\", err);\n    });\n\n  return app;\n}\n","import path from \"path\";\nimport { fileURLToPath } from \"url\";\nimport { createServer } from \"./index\";\nimport * as express from \"express\";\n\nconst app = createServer();\nconst port = process.env.PORT || 3000;\n\n// In production, serve the built SPA files\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\nconst distPath = path.join(__dirname, \"../spa\");\n\n// Serve static files\napp.use(express.static(distPath));\n\n// Handle React Router - serve index.html for all non-API routes\napp.get(\"*\", (req, res) => {\n  // Don't serve index.html for API routes\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\n    return res.status(404).json({ error: \"API endpoint not found\" });\n  }\n\n  res.sendFile(path.join(distPath, \"index.html\"));\n});\n\n// debug helpers - remove after troubleshooting\nconsole.log(\"ENV vars with placeholders:\", Object.entries(process.env).filter(([,v]) => typeof v==='string' && v.includes(\"${\")));\nconsole.log(\"Registered routes:\");\napp._router?.stack?.forEach((layer:any) => {\n  if (layer.route) console.log(Object.keys(layer.route.methods).join(\",\"), layer.route.path);\n});\n\napp.listen(port, () => {\n  console.log(`ðŸš€ Fusion Starter server running on port ${port}`);\n  console.log(`ðŸ“± Frontend: http://localhost:${port}`);\n  console.log(`ðŸ”§ API: http://localhost:${port}/api`);\n});\n\n// Graceful shutdown\nprocess.on(\"SIGTERM\", () => {\n  console.log(\"ðŸ›‘ Received SIGTERM, shutting down gracefully\");\n  process.exit(0);\n});\n\nprocess.on(\"SIGINT\", () => {\n  console.log(\"ðŸ›‘ Received SIGINT, shutting down gracefully\");\n  process.exit(0);\n});\n"],"names":["app","express"],"mappings":"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"}