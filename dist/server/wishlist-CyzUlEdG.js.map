{"version":3,"file":"wishlist-CyzUlEdG.js","sources":["../../server/routes/wishlist.ts"],"sourcesContent":["import express from \"express\";\nimport { createClient } from \"@supabase/supabase-js\";\n\nconst router = express.Router();\n\nconst SUPABASE_URL = process.env.SUPABASE_URL || \"\";\nconst SUPABASE_SERVICE_ROLE = process.env.SUPABASE_SERVICE_ROLE || \"\";\nconst supabaseAdmin = createClient(SUPABASE_URL, SUPABASE_SERVICE_ROLE, {\n  auth: { persistSession: false },\n});\n\n// GET /api/wishlist?user_id=...\nrouter.get(\"/\", async (req, res) => {\n  try {\n    const user_id = String(req.query.user_id || \"\").trim();\n    if (!user_id) return res.status(400).json({ error: \"user_id required\" });\n    const { data, error } = await supabaseAdmin\n      .from(\"wishlist\")\n      .select(\"product_id,created_at\")\n      .eq(\"user_id\", user_id)\n      .order(\"created_at\", { ascending: false });\n    if (error) return res.status(500).json({ error: error.message });\n    res.json(data || []);\n  } catch (e: any) {\n    console.error(\"GET /api/wishlist error\", e);\n    res.status(500).json({ error: String(e?.message || e) });\n  }\n});\n\n// POST /api/wishlist { user_id, product_id }\nrouter.post(\"/\", async (req, res) => {\n  try {\n    const { user_id, product_id } = req.body || {};\n    console.debug(\"POST /api/wishlist body:\", req.body);\n    if (!user_id || !product_id)\n      return res.status(400).json({ error: \"user_id and product_id required\" });\n    const payload = {\n      user_id: String(user_id),\n      product_id: String(product_id),\n    };\n    const { data, error } = await supabaseAdmin\n      .from(\"wishlist\")\n      .insert([payload])\n      .select();\n    console.debug(\"Supabase insert result:\", { data, error });\n    if (error)\n      return res.status(500).json({ error: error.message, details: error });\n    res.status(201).json((data && data[0]) || null);\n  } catch (e: any) {\n    console.error(\"POST /api/wishlist error\", e);\n    res.status(500).json({ error: String(e?.message || e), details: e });\n  }\n});\n\n// DELETE /api/wishlist { user_id, product_id }\nrouter.delete(\"/\", async (req, res) => {\n  try {\n    const { user_id, product_id } = req.body || {};\n    console.debug(\"DELETE /api/wishlist body:\", req.body);\n    if (!user_id || !product_id)\n      return res.status(400).json({ error: \"user_id and product_id required\" });\n    const { error, data } = await supabaseAdmin\n      .from(\"wishlist\")\n      .delete()\n      .match({ user_id: String(user_id), product_id: String(product_id) })\n      .select();\n    console.debug(\"Supabase delete result:\", { data, error });\n    if (error)\n      return res.status(500).json({ error: error.message, details: error });\n    res.json({ deleted: true });\n  } catch (e: any) {\n    console.error(\"DELETE /api/wishlist error\", e);\n    res.status(500).json({ error: String(e?.message || e), details: e });\n  }\n});\n\nexport default router;\n"],"names":["express"],"mappings":";;AAGA,MAAM,SAASA,iBAAQ,OAAA;AAEvB,MAAM,eAAe,QAAQ,IAAI,gBAAgB;AACjD,MAAM,wBAAwB,QAAQ,IAAI,yBAAyB;AACnE,MAAM,gBAAgB,aAAa,cAAc,uBAAuB;AAAA,EACtE,MAAM,EAAE,gBAAgB,MAAA;AAC1B,CAAC;AAGD,OAAO,IAAI,KAAK,OAAO,KAAK,QAAQ;AAClC,MAAI;AACF,UAAM,UAAU,OAAO,IAAI,MAAM,WAAW,EAAE,EAAE,KAAA;AAChD,QAAI,CAAC,QAAS,QAAO,IAAI,OAAO,GAAG,EAAE,KAAK,EAAE,OAAO,oBAAoB;AACvE,UAAM,EAAE,MAAM,UAAU,MAAM,cAC3B,KAAK,UAAU,EACf,OAAO,uBAAuB,EAC9B,GAAG,WAAW,OAAO,EACrB,MAAM,cAAc,EAAE,WAAW,OAAO;AAC3C,QAAI,MAAO,QAAO,IAAI,OAAO,GAAG,EAAE,KAAK,EAAE,OAAO,MAAM,SAAS;AAC/D,QAAI,KAAK,QAAQ,EAAE;AAAA,EACrB,SAAS,GAAQ;AACf,YAAQ,MAAM,2BAA2B,CAAC;AAC1C,QAAI,OAAO,GAAG,EAAE,KAAK,EAAE,OAAO,OAAO,GAAG,WAAW,CAAC,EAAA,CAAG;AAAA,EACzD;AACF,CAAC;AAGD,OAAO,KAAK,KAAK,OAAO,KAAK,QAAQ;AACnC,MAAI;AACF,UAAM,EAAE,SAAS,WAAA,IAAe,IAAI,QAAQ,CAAA;AAC5C,YAAQ,MAAM,4BAA4B,IAAI,IAAI;AAClD,QAAI,CAAC,WAAW,CAAC;AACf,aAAO,IAAI,OAAO,GAAG,EAAE,KAAK,EAAE,OAAO,mCAAmC;AAC1E,UAAM,UAAU;AAAA,MACd,SAAS,OAAO,OAAO;AAAA,MACvB,YAAY,OAAO,UAAU;AAAA,IAAA;AAE/B,UAAM,EAAE,MAAM,MAAA,IAAU,MAAM,cAC3B,KAAK,UAAU,EACf,OAAO,CAAC,OAAO,CAAC,EAChB,OAAA;AACH,YAAQ,MAAM,2BAA2B,EAAE,MAAM,OAAO;AACxD,QAAI;AACF,aAAO,IAAI,OAAO,GAAG,EAAE,KAAK,EAAE,OAAO,MAAM,SAAS,SAAS,MAAA,CAAO;AACtE,QAAI,OAAO,GAAG,EAAE,KAAM,QAAQ,KAAK,CAAC,KAAM,IAAI;AAAA,EAChD,SAAS,GAAQ;AACf,YAAQ,MAAM,4BAA4B,CAAC;AAC3C,QAAI,OAAO,GAAG,EAAE,KAAK,EAAE,OAAO,OAAO,GAAG,WAAW,CAAC,GAAG,SAAS,GAAG;AAAA,EACrE;AACF,CAAC;AAGD,OAAO,OAAO,KAAK,OAAO,KAAK,QAAQ;AACrC,MAAI;AACF,UAAM,EAAE,SAAS,WAAA,IAAe,IAAI,QAAQ,CAAA;AAC5C,YAAQ,MAAM,8BAA8B,IAAI,IAAI;AACpD,QAAI,CAAC,WAAW,CAAC;AACf,aAAO,IAAI,OAAO,GAAG,EAAE,KAAK,EAAE,OAAO,mCAAmC;AAC1E,UAAM,EAAE,OAAO,SAAS,MAAM,cAC3B,KAAK,UAAU,EACf,SACA,MAAM,EAAE,SAAS,OAAO,OAAO,GAAG,YAAY,OAAO,UAAU,GAAG,EAClE,OAAA;AACH,YAAQ,MAAM,2BAA2B,EAAE,MAAM,OAAO;AACxD,QAAI;AACF,aAAO,IAAI,OAAO,GAAG,EAAE,KAAK,EAAE,OAAO,MAAM,SAAS,SAAS,MAAA,CAAO;AACtE,QAAI,KAAK,EAAE,SAAS,KAAA,CAAM;AAAA,EAC5B,SAAS,GAAQ;AACf,YAAQ,MAAM,8BAA8B,CAAC;AAC7C,QAAI,OAAO,GAAG,EAAE,KAAK,EAAE,OAAO,OAAO,GAAG,WAAW,CAAC,GAAG,SAAS,GAAG;AAAA,EACrE;AACF,CAAC;"}