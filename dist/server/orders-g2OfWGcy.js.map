{"version":3,"file":"orders-g2OfWGcy.js","sources":["../../server/routes/orders.ts"],"sourcesContent":["import express from \"express\";\nimport { createClient } from \"@supabase/supabase-js\";\n\nconst router = express.Router();\n\nconst SUPABASE_URL = process.env.SUPABASE_URL || \"\";\nconst SUPABASE_SERVICE_ROLE = process.env.SUPABASE_SERVICE_ROLE || \"\";\nconst supabaseAdmin = createClient(SUPABASE_URL, SUPABASE_SERVICE_ROLE, {\n  auth: { persistSession: false },\n});\n\n// GET /api/orders?user_id=...\nrouter.get(\"/\", async (req, res) => {\n  try {\n    const user_id = String(req.query.user_id || \"\").trim();\n    if (!user_id) return res.status(400).json({ error: \"user_id required\" });\n    const { data, error } = await supabaseAdmin\n      .from(\"orders\")\n      .select(\"id, product_id, quantity, status, created_at\")\n      .eq(\"user_id\", user_id)\n      .order(\"created_at\", { ascending: false });\n    if (error) return res.status(500).json({ error: error.message });\n    res.json(data || []);\n  } catch (e: any) {\n    console.error(\"GET /api/orders error\", e);\n    res.status(500).json({ error: String(e?.message || e) });\n  }\n});\n\n// POST /api/orders { user_id, product_id, quantity, status }\nrouter.post(\"/\", async (req, res) => {\n  try {\n    const {\n      user_id,\n      product_id,\n      quantity = 1,\n      status = \"completed\",\n    } = req.body || {};\n    console.log(\"POST /api/orders body:\", req.body);\n    if (!user_id || !product_id)\n      return res.status(400).json({ error: \"user_id and product_id required\" });\n    const resp = await supabaseAdmin.from(\"orders\").insert([\n      {\n        user_id: String(user_id),\n        product_id: String(product_id),\n        quantity: Number(quantity),\n        status: String(status),\n      },\n    ]);\n    console.log(\"supabase insert response:\", resp);\n    const { data, error } = resp as any;\n    if (error) {\n      console.error(\"Supabase insert error:\", error);\n      return res.status(500).json({ error: error.message || error });\n    }\n    res.status(201).json((data && data[0]) || null);\n  } catch (e: any) {\n    console.error(\"POST /api/orders error\", e);\n    res.status(500).json({ error: String(e?.message || e) });\n  }\n});\n\n// DELETE /api/orders - body: { user_id, order_id?, product_id? }\nrouter.delete(\"/\", async (req, res) => {\n  try {\n    const { user_id, order_id, product_id } = req.body || {};\n    if (!user_id) return res.status(400).json({ error: \"user_id required\" });\n\n    if (order_id) {\n      const { data, error } = await supabaseAdmin\n        .from(\"orders\")\n        .delete()\n        .eq(\"id\", order_id)\n        .eq(\"user_id\", user_id);\n      if (error) return res.status(500).json({ error: error.message });\n      return res.json({ deleted: data?.length || 0 });\n    }\n\n    if (product_id) {\n      const { data, error } = await supabaseAdmin\n        .from(\"orders\")\n        .delete()\n        .eq(\"user_id\", user_id)\n        .eq(\"product_id\", product_id);\n      if (error) return res.status(500).json({ error: error.message });\n      return res.json({ deleted: data?.length || 0 });\n    }\n\n    return res.status(400).json({ error: \"order_id or product_id required\" });\n  } catch (e: any) {\n    console.error(\"DELETE /api/orders error\", e);\n    res.status(500).json({ error: String(e?.message || e) });\n  }\n});\n\nexport default router;\n"],"names":["express"],"mappings":"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"}